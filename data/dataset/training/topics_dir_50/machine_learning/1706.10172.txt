Prepaid or Postpaid? That is the question.
Novel Methods of Subscription Type Prediction
in Mobile Phone Services
Yongjun Liao, Wei Du, Márton Karsai, Carlos Sarraute, Martin Minnoni and Eric
Fleury
Abstract In this paper we investigate the behavioural differences between mobile
phone customers with prepaid and postpaid subscriptions. Our study reveals that (a)
postpaid customers are more active in terms of service usage and (b) there are strong
structural correlations in the mobile phone call network as connections between cus-
tomers of the same subscription type are much more frequent than those between
customers of different subscription types. Based on these observations we provide
methods to detect the subscription type of customers by using information about
their personal call statistics, and also their egocentric networks simultaneously. The
key of our first approach is to cast this classification problem as a problem of graph
labelling, which can be solved by max-flow min-cut algorithms. Our experiments
show that, by using both user attributes and relationships, the proposed graph la-
belling approach is able to achieve a classification accuracy of ∼ 87%, which out-
performs by ∼ 7% supervised learning methods using only user attributes. In our
second problem we aim to infer the subscription type of customers of external op-
erators. We propose via approximate methods to solve this problem by using node
attributes, and a two-ways indirect inference method based on observed homophilic
structural correlations. Our results have straightforward applications in behavioural
prediction and personal marketing.
Yongjun Liao (e-mail: yongjun.liao@inria.fr),
Márton Karsai (e-mail: marton.karsai@inria.fr),
Eric Fleury (e-mail: eric.fleury@inria.fr)
Univ Lyon, ENS de Lyon, Inria, CNRS, UCB Lyon 1, LIP UMR 5668, IXXI, F-69342, Lyon,
France.
Wei Du (e-mail: wei.du@insa-lyon.fr)
Univ Lyon, INSA Lyon, Inria, CITI, F-69621 Villeurbanne, France.
Carlos Sarraute (e-mail: charles@grandata.com), Martin Minnoni, (e-mail: martin@
grandata.com)
Grandata Labs, Bartolome Cruz 1818 V. Lopez. Buenos Aires, Argentina.
1
ar
X
iv
:1
70
6.
10
17
2v
1 
 [
cs
.S
I]
  3
0 
Ju
n 
20
17
2 Authors Suppressed Due to Excessive Length
1 Introduction
In most of the countries mobile phone operators propose two subscription options
for their customers. In case of prepaid subscription, credit is purchased in advance
by the customer and access to the service is granted only if there is available credit.
On the contrary, in case of postpaid subscription, a user is engaged in a long-term
contract with the operator, and service is billed according to the usage at the end
of each month. Typically, a contract specifies a limit or “allowance” of minutes and
text messages for what a user is billed at a flat rate, while any further usage incurs
extra charges. Due to these differences in the level and time of engagement, differ-
ent options of subscriptions may be adopted by typical user groups characterised
by similar age, location, socioeconomic status, etc., Moreover, due to effects of ho-
mophily and social influence these people may be even connected to each other and
communicate frequently thus forming a locally homogeneous sub-structures in the
larger mobile communication network. Such correlations between the communica-
tion dynamics, structure and customer features can potentially be used to differenti-
ate between customers.
In this paper, we are interested in such behavioural differences of prepaid and
postpaid customers for at least three reasons.
• The detection of typical patterns of service usage corresponding to different sub-
scription types may provide useful information for the operator when planning
network management and service pricing.
• The identification of customers with atypical service usage patterns of their actual
subscription type may help the design of better direct advertising and personal
services.
• The inference of the subscription type of customers of other operators could help
direct marketing to convince customers to migrate to the actual provider.
Our study based on the analysis of customers of a single operator reveals that the
main difference between prepaid and postpaid users is in the way they use mobile
phone services. As a first result we found that postpaid users are more active and
on average make more calls, towards more people as compared to prepaid users.
We also found that only relying on attributes of call statistics, such as total duration
and number of outgoing calls, we can classify fairly well customers, with an overall
accuracy of ∼ 80%, by using standard machine learning tools.
However, to achieve better results, further we investigated the proxy social net-
work of users mapped out from their mobile phone communication events. This
analysis revealed strong structural correlations among users of the same subscrip-
tion type, who actually called each other ∼ 3 times more frequently than others
holding the opposite subscription type. This observation suggested that the classifi-
cation accuracy could potentially be improved by algorithms considering not only
individual activity patterns but also relationships between users at the same time.
This is important, as, on the one hand, classification methods typically focus on find-
ing distinct attributes associated to each class, while ignoring the network topology;
and on the other hand, methods aiming to partition networks (e.g. tools of commu-
Prepaid or Postpaid? That is the question 3
nity detection) typically ignore attributes associated to each node. By considering
simultaneously the two sources of information, we propose an approach to com-
bine classification and graph partitioning techniques in a unified framework To this
end, we formulate the classification problem as a problem of graph labelling, i.e. as-
signing a label, either prepaid or postpaid, to each user by taking into account both
the user attributes and the structure in the mobile phone call network. This graph
labelling problem can be solved by algorithms such as max-flow min-cut [14, 4],
which in turn lead to an improved classification accuracy of 87%.
Inspired by these results, we further addressed the practical problem of infer-
ring the service type of customers of external operators from the view of the host
provider. Such information is important for mobile service operators to expand busi-
ness in the already crowded telecommunication market. In this settings we consider
two sets of customers: one set includes customers of the host operator (company
users) with the subscription type and all call records available. The other set includes
customers of external operators (non-company users) with no information available
but only about their interactions with company users. As mobile service operators
never share the data of their customers for the concerns of economy, security and
privacy, an operator can only perform this inference problem by using visible data
such as the subscription types and the communication records of its own company
users (including calls with non-company users) but without knowing anything about
the communications between any two non-company users. However, by assuming
that the same structural correlations exists between customers of different providers
as observed between company users, we propose possible ways to infer and indi-
rectly verify subscription types of non-company users, even without knowing their
real values. This explanatory study below shows that our direct inference method,
based on node attributes and structure extracted from call data between two oper-
ators, alone can achieve an accuracy of ∼ 70%, while indirect inference methods
may also provide meaningful insights.
The rest of the paper is organised as follows. In Section 2 we discuss the related
works, in Section 3 and 4 we describe the dataset in use and the classification re-
sults using machine learning methods based merely on node attributes. Section 5
presents our graph labelling algorithm which exploits both node attributes and the
local network structure. In Section 6 we introduce our methods of inference of the
subscription types of non-company users. Finally in Section 7 we conclude our work
and discuss some potential future directions of research.
2 Related Work
Our work is motivated by the work of Yang et al. [18] in which network communities
are identified by using both user attributes and the structure of the social network.
However, one important distinction of the present work is that in [18] the authors
aimed to cluster nodes with similar attributes into some apriori unknown number
of communities, whereas we aim to find discriminating attributes of nodes and as-
4 Authors Suppressed Due to Excessive Length
sign them to two pre-defined communities. In addition, our approach is based on
graph labelling and solved by simple graph algorithms, whereas [18] is based on
a generative model optimised by block-coordinate descent. Other related works on
community detection with user attributes include [5, 15, 17]. However, all of them
focus on clustering nodes in a network into priori unknown partitions or communi-
ties, while none of them address the classification of nodes into pre-defined classes
as here. A related classification problem which has been well studied in the litera-
ture is the inference of user demographics such as nationality, gender and age from
social and mobile call networks [8, 6, 12, 2, 19]. While interesting, most of the pre-
vious work exploited only node attributes some of which are computed from local
connections.
Knowledge transfer from one network to another is also a hot topic in the field
of machine learning and social network analysis. Most of these works focused on
the inference of the structure, i.e. link prediction, using information from multi-
ple networks. For example, Eagle et al. inferred the friendship network from mo-
bile call data [9] and Dong et al. [7] and Ahmad et al. [1] predicted links across
heterogeneous networks, which may only be partially visible. In addition, Tang et
al. [16] studied the problems of relationship classification across networks and Kong
et al. [11] inferred the anchor links between users in different social networks, i.e.
the same user with different accounts. In contrast to most previous work, our study
on cross-network inference focuses on the classification of nodes in the targeted
network using only the connections between two networks.
3 Dataset
Our dataset is a sequence of anonymised Call Detailed Records (CDR) collected by
a single operator in a Latin American country. It contains∼ 280 millions of call and
SMS events recorded during one month between ∼ 20 millions of mobile phone
users. Each CDR records the starting time of the event (date and time), communi-
cation type (call or SMS), the call duration (in case of call event), the anonymised
identifier of the user originating the call (caller), and the anonymised identifier of
the person receiving the call (callee), but not the content of that transaction. Note
that from the caller and callee at least one is a customer of the operator.
For the first part of our study we constructed a dataset (DS1) of 3.2 million users,
who are actual customers of the operator, and have available information about there
subscription type being prepaid or postpaid. After filtering out users with either too
few (total duration of calls < 10 seconds) or unrealistically many (total duration
of calls > 100,000 seconds) communications, we obtained about 1.3 million pre-
paid and 1.2 million postpaid users in total. For the purpose of our investigation,
from the 190 million CDRs of 2.5 million selected users, we constructed a directed
weighted communication network with 90 million links between interacting users.
More precisely, the communication network G = (V,E) was define by mobile users
as nodes connected by directed weighted links. Links (u,v,w) ∈ E between users u
Prepaid or Postpaid? That is the question 5
and v (where u,v ∈ V ) were drawn if at least one communication event took place
between them during the observation period. The weight w of a directed link was
defined as the number of communication events or the total duration of calls took
place between u and v (actual weight definition is specified later). Note that DS1
is balanced with roughly the same number of users for each type. However, our
approach does not rely on this fact as the only assumption we take is based on a
structural correlation in the communication network, which we will verify in the
next sections.
For the second part of our study we considered the whole available communi-
cation sequence to construct a dataset (DS2). After similar filtering as before, we
obtained 3.1 million company users (1.6 million prepaid and 1.5 million postpaid),
with full list of CDRs available, and 14.1 million non-company users, with CDRs
available only with company users. Note that the increase of company users in DS2
as compared to DS1 is due to the company users who only interacted with non-
company users, thus appear only in DS2 with non-zero degree. In DS2 in total we
had 190 million calls between company users and 90 million calls between com-
pany and non-company users. Using these events we constructed a network, which
contained 90 million links between company users (just as in DS1), and 44.6 million
links between company and non-company users.
4 User Attributes and Classification
For each user, using the first dataset DS1 we extracted a number of attributes related
to call statistics including:
• total number of outgoing calls;
• total duration of outgoing calls;
• mean and standard derivation of the duration of outgoing calls;
• outgoing degree (number of callees) in the CDR network.
These attributes turned out to be very different for prepaid and for postpaid users as
shown in Figure 1 where the distributions of (a) the total number of outgoing calls,
(b) the total and (c) the average duration of outgoing calls, and (d) the outgoing
degrees are depicted. From these measures we found that on average postpaid users
make 2.9 times more calls to 2.5 times more people as compared to prepaid users.
Note that we tested and found that attributes related to incoming calls and SMS are
not informative. By using these attributes, we built our classifiers with different ma-
chine learning methods including support vector machines (SVM), Boosting (Ad-
aBoost), Naive Bayes and Decision Tree to estimate the subscription type of each
user. In every experiment presented in the paper, the classifiers were trained using
20,000 randomly sampled users, half of them prepaid and half postpaid, and tested
on the rest of the 2.5 million users. After these experiments we found that SVM and
AdaBoost achieved the best accuracy of about 80%, while Naive Bayes achieved
about 77% and Decision Tree about 71%. The confusion matrix (each column of
6 Authors Suppressed Due to Excessive Length
(a) (b)
(c) (d)
Fig. 1 Distribution of user call activity attributes as (a) total number of outgoing calls, (b) the
total (in the logarithmic space) and (c) average duration of each outgoing call and (d) the outgoing
degree of each user.
the matrix represents the instances in a predicted class while each row represents
the instances in an actual class) for SVM is given in Table 1.
Note that the Naive Bayes method is a probabilistic learning method providing a
probability for each node to belong to one of the subscription type, unlike SVM and
AdaBoost, which provide binary values for labelling. For this reason, although less
accurate, Naive Bayes is used later to define our graph labelling approach.
Table 1 Confusion matrix by SVM.
accuracy=0.803 postpaid prepaid
postpaid 0.822 0.178
prepaid 0.214 0.786
Besides the above-mentioned attributes, which are related only to call statistics,
attributes extracted from the social-communication network may also help our pre-
diction. The analysis of the network revealed a strong homophilic structural corre-
lation, as calls between the same type of users (prepaid or postpaid) appeared on
Prepaid or Postpaid? That is the question 7
average 3 times more often than the ones across the two types of users. The matrix
disclosing the fraction of calls by the two type of users is given in Table 2. This
highly partitioned structure suggests that potentially the classification accuracy can
be further improved by exploiting the observed sparse connectivity between the two
user sets.
Table 2 Proportion of calls within and between the two types of users.
caller
callee
prepaid postpaid
prepaid 0.791 0.209
postpaid 0.173 0.827
To test our conjecture, we extracted postpaid portion attributes, by using the
known subscription types of neighbouring users for each user. The portion attributes
in focus were:
F in = n
po
i /ni, F
i
c = c
po
i /ci, and F
i
d = d
po
i /di, (1)
where F in (resp. F
i
c , and F
i
d) assigns the portion of the n
po
i number of postpaid users in
the callee set (resp. the cpoi number of calls, and the d
po
i duration of calls to postpaid
users) and the ni number of users in the callee set (resp. the ci number of calls, and
the di total duration of calls) of a user i. With these extra portion attributes we could
largely improve the accuracy of SVM and AdaBoost from ∼ 80% to ∼ 89%. The
confusion matrix for SVM is given in Table 3.
However, in real settings it is impossible to measure these portion attributes, as
they require the knowledge of the service type of each user, which are to be es-
timated. This way the outcomes provided by these methods are only informal in
terms of our original classification problem as they use information what are assum-
ingly not available. On the other hand, these methods can be used to detect false
positive cases, where a user was assigned with a subscription type, while having an-
other type of contract. This information can be used for direct marketing to provide
services to costumers, which might better fit their needs. In any case, the positive
results of this initial analysis motivated us to exploit the network topology in our
new classification method defined in the next section.
Table 3 Confusion matrix for SVM with the proportion attributes.
accuracy=0.891 postpaid prepaid
postpaid 0.897 0.103
prepaid 0.115 0.885
8 Authors Suppressed Due to Excessive Length
5 Classification with User Attributes and Network Topology
5.1 Graph Labeling
The key idea here is to exploit both user attributes and the network structure to detect
the service type of each user. This is to be done without any prior knowledge about
the subscription types of users. To do so, we cast the classification problem as a
problem of graph labelling and show that this graph labelling problem is equivalent
to the classic network flow problem, namely max-flow min-cut. According to the
max-flow min-cut theorem [14], in a flow network, the maximum amount of flow
passing from the source s to the sink t is equal to the minimum cut, i.e. the smallest
total cost of the links, which if removed would disconnect the source s from the sink
t.
prepaid
postpaid
Fig. 2 Graph labelling for the classification of the service type of each user. Square nodes represent
users and circle nodes represent the labels of prepaid and postpaid. Each user is connected in the
mobile call network and with both label nodes. A feasible cut will partition the graph so that no
flow can go from the source (prepaid) to the sink (postpaid). The minimum cut (the dashed line) is
the feasible cut with the least overall cost.
To see the connection between the two seemingly irrelevant problems, we take
the CDR network G = (V,E) and construct a new graph G′ = (V ′,E ′). We add
two auxiliary nodes V ′ = V ∪ {s, t}: this two nodes represents the two labels of
prepaid and postpaid, which are assigned as the source s and the sink t respec-
tively, as illustrated in Figure 2. Initially, we connect each user to both label nodes:
E ′ = E ∪{(s,v) |∀v ∈ V}∪{(u, t) |∀u ∈ V}. We call the links (e = (u,v),u,v ∈ V )
between users as social links and the links (e = (s,u) or e = (u, t), u ∈ V ) between
any user and one of the two label nodes as the labelling links. The costs associated
to the social and labelling links will be described in the next section. However, in-
dependent of the definition of the cost functions, the following theorem guarantees
that the minimum cut of the graph in Figure 2 assigns a label to each user.
Theorem 1. The minimum cut of a graph like in figure 2 will cut one and only one
labelling link of the two labelling links of each user.
Prepaid or Postpaid? That is the question 9
Proof. By definition, a cut is feasible if it disconnects the source and the sink, and
the minimum cut is the feasible cut with the least total cost. It is trivial that any
feasible cut will cut at least one of the two labelling links of each user, however we
need to show that any feasible cut that cuts both labelling links from a user is not a
minimum cut of the graph. To see this, we consider a subgraph with a pair of doubly
connected users. It is clear that the minimum cut of this subgraph can only be one of
the four possible cases as shown in Figure 3, all of which cut only one labelling link
of each node. Which of these cuts apply in an actual subgraph depends on the cost
defined on each link, but in any case, any graph containing such subgraphs must
have the minimum cut which holds the same condition.
It is important to note that the labelling link which is cut between a node and a
label indicates the labelling of the node, which reflects the intuition that cut links
tend to have smaller costs.
××
(a) Case 1
××
(b) Case 2
×
×
×
(c) Case 3
×
×
×
(d) Case 4
Fig. 3 4 possible cases for the feasible cut of the subgraph of a pair of connected users. Note that
the labelling link which was cut indicates the labelling of a user. In the last 2 cases, only the one
social link with a cross sign is cut.
5.2 Cost Functions and Problem Formulation
In order to extend our classification problem as a graph labelling or max-flow min-
cut problem, we need to associate a cost to each link in Figure 2. To this end, we use
the information about both user attributes and relationships encoded in the social
structure. For user u, let xu be the user attribute vector, extracted from call statistics
as discussed in Section 4, and fu be the possible label of either prepaid or post-
paid, represented by 0 and 1 respectively. On the one hand, we use Naive Bayes to
compute the probability P( fu|xu) that user u is a prepaid ( fu=0) and postpaid ( fu=1)
subscriber. Note that Naive Bayes was adopted as it provides the probability of the
classification rather than just a binary classification result. Subsequently, we define
the Du cost of each labelling link based on the the probability function P( fu|xu) as:
Du( fu = 0) =−log(P( fu = 0|xu)).
Du( fu = 1) =−log(P( fu = 1|xu)). (2)
10 Authors Suppressed Due to Excessive Length
This definition assigns a small cost to a labelling link if the probability of a user
taking the corresponding label is large. Note that in Naive Bayes, the normalisation
condition holds, i.e., P( fu = 0|xu)+P( fu = 1|xu) = 1, while we force P( fu|xu) >
1e−10 to avoid zero values in the logarithm of Eq.2.
On the other hand, to define the cost of a social link, we rely on our earlier ob-
servations that postpaid users tend to have 2.5 times larger kout outgoing degrees as
compared to prepaid customers, and that the two types of users are sparsely con-
nected with each other. The outgoing degree kout(u) of each user u is a simple struc-
tural attribute, which turned out to be discriminative here. Thus, we define the cost
of a social link w(u,v) as a slightly modified Ising model [10], i.e.,
w(u,v)( fu = 0, fv = 0) = w(u,v)( fu = 1, fv = 1) = 0,
w(u,v)( fu = 0, fv = 1) =
1
kout(v)
,
w(u,v)( fu = 1, fv = 0) =
1
kout(u)
. (3)
This definition assigns zero cost to a link, which connects two users of the same
label (corresponding to the first two cases in Figure 3 (a) and (b)). Otherwise, when
the label is different, a small cost is assigned that is inversely proportional to the
outgoing degree of the user labeled as a postpaid customer (corresponding to the
last two cases in Figure 3 (c) and (d)). Note that we also tried to define the cost as a
measure of social strength between connected users, such as the number of outgoing
calls or duration of outgoing calls, but obtained worse performance.
With the above defined cost functions for each social link (u,v), the graph la-
belling problem in Figure 2 can be interpreted as an energy minimisation problem
formulated as:
min ∑
u∈V
Du( fu)+λ ∑
u,v∈V
w(u,v)( fu, fv). (4)
Interestingly, Eq. 4 can be associated to a class of discrete optimisation problems,
which has been well studied in the field of computer vision and machine learn-
ing [4]. In this terminology, the first term Du, called the data term, reflects the cost
of the labelling link between u and label fu, while the second term is the smoothness
term, reflecting the costs of social links between users u and v, which encourages
connected users to take the same labels. Note that λ is a parameter that controls the
trade off between the two terms and its impact on accuracy will be described in the
next section. Also note that Eq. 4 can be solved efficiently by any standard max-flow
min-cut methods among which the push-relabel algorithm was chosen. In addition,
we remark that the cost functions defined in Eq. 2 and 3 do not require the labels
of the nodes as inputs as they merely rely on probabilities determined by the Naive
Bayes method using user attributes other than portion attributes.
Prepaid or Postpaid? That is the question 11
5.3 Implementation and Results
Based on the above defined model formulation we can solve the graph labelling
problem using standard max-flow min-cut algorithms [3]. Our experiments showed
that the graph labelling approach achieved an accuracy of ∼ 84% which is better
than using supervised learning on user attributes alone. Note that the parameter λ
has an impact on the classification accuracy. If λ = 0, we ignore completely social
relationships and graph labelling degenerates to Naive Bayes using user attributes,
while if λ =+∞, we ignore completely user attributes and enforce all nodes to take
the same label, resulting in an accuracy of ∼ 50% due to the similar sizes of two
types of users in our dataset. Thus, we tuned λ by cross validation to our dataset
and found the best value to be 100. Enlarging λ by 10 times resulted in an accuracy
of ∼ 74%, whereas shrinking λ by 10 times gave us ∼ 80%.
Table 4 Confusion matrix by our graph labelling approach.
accuracy=0.868 postpaid prepaid
postpaid 0.901 0.099
prepaid 0.163 0.837
Table 5 Classification accuracy of different methods using only user attributes.
method accuracy
graph labeling with graph pruning 0.868
graph labeling 0.844
SVM with user attributes 0.803
Naive Bayes with user attributes 0.770
In addition, we tried to prune the graph by fixing the label of some users under
two conditions: if the probability of a user belonging to a class was larger than a
threshold τ1 and if the average probability of its neighbours belonging to the same
class was larger than another threshold τ2. In our experiments, we set τ1 = 85% and
τ2 = 65% which led to fixed labels for about 16% of users. This way of pruning im-
proved the accuracy of our prediction to 87%. The confusion matrix of this method
is given in Table 4, while Table 5 summarises the accuracy achieved by all different
methods in applied so far.
Note that the runtime of our approach is about 0.5 hour on a desktop with 32G
memory and CPU Xeon of 1.90GHz which is not that slow considering the size of
our graph. In particular, we adopted the push-relabel method to solve the max-flow
min-cut problem, which has the computational complexity of O(V 2E), where V and
E are the number of nodes and edges respectively. Also note that, our graph labelling
algorithm utilises the Naive Bayes for modelling the probability that a user is a
prepaid or postpaid subscriber. This calculation requires 20,000 randomly sampled
training data, as mentioned earlier. However, in the optimisation, we assign labels to
12 Authors Suppressed Due to Excessive Length
all 2.5M users including ones in the training set as well. The training samples have
no impact to the results as they are less than 1% of the total users and they are only
used for learning the cost of labelling links.
6 Subscription type inference of non-company users
In most of the countries typically there are several mobile service providers, who
compete for customers on the same market. However a provider has access to user
data (e.g. subscription type) of its own customers only, while information about
the users of other providers are limited to the CDRs between the company and non-
company customers, recorded for billing purposes. In this section we use such CDRs
to introduce two methods to infer the subscription type of non-company users from
a company point of view. Such knowledge is certainly valuable for a provider e.g.
to design advertisement strategies to motivate the churning of non-company users.
However, this is a difficult problem as the direct verification of inferred subscrip-
tion types of non-company users is not possible. To come around this problem, we
build on the assumption that call feature patterns, which were shown to be relevant
in our classification problem earlier (see Section 4), actually characterise all cus-
tomers on the market, not only the company users. This way such features may pro-
vide predictive power when characterising calling patterns between company and
non-company users, thus can be effectively used for inference and help the design
of new validation methods.
6.1 Inference using call statistics
In our first method let’s consider two mobile providers: A represents our central
company with available information about its company users; while B is an external
company (of non-company users) with no user information available. First we check
whether characteristic call features, observed in Section 4, also differentiate between
prepaid and postpaid users in A but considering only inter-company communication.
Here we take each users in A from DS2, and using their CDRs only with users in B ,
we measure the distributions of the number and duration of outgoing calls and their
out-degree. As shown in Fig.4 these distributions yet appear to be very different
for prepaid and postpaid A users, just as it was shown earlier for intra-company
communications. It suggests that these node attributes are not subjective to intra-
company communications only but may generalise for any communication tie, even
between users of different providers.
Based on these observations we assume that these features characterise symmet-
rically the communications between any users independent of their provider. How-
ever, since we have access to the information of A users only, this is the only set
we can use for direct verification of the results of an inference method. Thus in our
Prepaid or Postpaid? That is the question 13
0 50 100 150 200 250 300 350 400
number of outgoing calls
0.0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
fr
a
ct
io
n
prepaid
postpaid
(a)
0 1 2 3 4 5
total duration of outgoing calls (second in log space)
0.000
0.005
0.010
0.015
0.020
0.025
0.030
0.035
fr
a
ct
io
n
prepaid
postpaid
(b)
0 50 100 150 200 250 300 350 400
average duration of outgoing calls (second)
0.00
0.01
0.02
0.03
0.04
0.05
0.06
fr
a
ct
io
n
prepaid
postpaid
(c)
0 10 20 30 40 50 60
outgoing degree
0.0
0.1
0.2
0.3
0.4
0.5
fr
a
ct
io
n
prepaid
postpaid
(d)
Fig. 4 From left to right are the distributions of each user for the total number of outgoing calls, the
total (in the logarithmic space) and average duration of each outgoing call and the outgoing degree
of each user. Note that these attributes are computed using the data of calls from the operator
network of A to that of B, whereas those in Figure 1 are computed using the data of calls within
the operator network of A.
first approach we took the point of the company B , and we actually try to infer the
subscription types of users in A , by only using CDRs between the users of A and B
and the characteristic attributes shown in Fig.4. We applied the same machine learn-
ing methods with the same setting as described in section 4, but now on the dataset
DS2. This experiments showed that our method based merely on statistical node
attributes alone can achieve an accuracy of ∼ 68.2% using SVM and Boosting. The
confusion matrix by Boosting is given in Table 6. It demonstrates that using only
inter-company communications and user attributes, one can infer the subscription
types of customers of another provider with relatively high accuracy.
Table 6 Confusion matrix by Boosting.
accuracy=0.687 postpaid prepaid
postpaid 0.682 0.318
prepaid 0.317 0.693
14 Authors Suppressed Due to Excessive Length
6.2 Inference using label propagation
In our earlier data analysis, in Section 4, we found that calls between the same
type of users (prepaid or postpaid) appeared ∼ 3 times more frequently than be-
tween users holding different subscriptions. Although this was observed between
only users of A , we may assume similar homophilic correlations to be present be-
tween users of A and B . Based on this assumption here we present a second method
to infer subscription types of non-company users using label propagation together
with an indirect validation method.
Let’s consider a bipartite network G = (VA,VB,EAB), where VA is the set of all
A company users, VB is the set of all B non-company users, and EAB contains all
directed links between users in VA and VB. A directed link is defined between a ∈VA
and b∈VB (resp. between b and a) if a called b (resp. b called a) at least once during
the observation. In this network we know the subscription types of all users in VA,
while we would like to infer the subscriptions of VB users. As edges in EAB are real
social ties inferred from communication records, they are not independent but show
degree correlations, could be strong ties of communities, and may show homophilic
correlations as we mentioned earlier. The knowledge of subscription types on side
A , together with the strong effects of subscription homophily, and the structurally
correlated bipartite network provides us a potential way to define a label propagation
method using majority rule to infer the subscription types of non-company users in
VB.
Table 7 Confusion matrix of label inference on the empirical structure.
accuracy=0.964 postpaid prepaid
postpaid 0.961 0.039
prepaid 0.034 0.966
More precisely, we take all users from VB and their incoming ties, and assign
them a label (prepaid or postpaid) corresponding to the majority of the subscription
type of their connected friends in VA. In case of equality we selected randomly a
label by respecting the overall balance between pre- and postpaid users observed in
A . However, even we can assign labels for all the users in VB, we cannot validate
the precision of our inference as we do not have access to the subscription types of
non-company users. On the other hand, assuming all correlations to be symmetric
between the two sets of users, we can use the inferred labels of VB users to assign
labels to users in VA applying the same majority rule inference method. After these
two ways of label inference we can validate the precision of the inferred labels of
users in VA by comparing them to their real subscription types. The result will give
us a lower bound for the inference error in VB as erroneous inference propagates
also during the process, and the entropy of inference cannot increase during the two
ways of inference. As a result we found that on average our method identified the
correct labels of 96.4% of users in VA. Our measurements were averaged over 100
Prepaid or Postpaid? That is the question 15
independent realisations with results summarised in the confusion matrix shown in
Table 7.
This method could give trivial results if two conditions are satisfied at the same
time: the average degree in the bipartite network is 1, and all links are bidirectional.
In our case, although the 89% of links found to be bidirectional, the average de-
gree is relatively high 〈k〉 ' 2.593 suggesting that the inferred labels are not trivial.
This can be further validated by eliminating structural correlations from the bipartite
network and see whether we can recover the original results. If the accuracy of infer-
ence remains the same in the uncorrelated network, our results are trivial and struc-
tural correlations do not play a role here. On the other hand if the accuracy drops in
the uncorrelated networks, our results are meaningful. To remove structural correla-
tions we used a configuration network model scheme [13], i.e., we choose random
pairs of links of the same direction and swapped them while disallowing double
links. Repeating this step several times we received a random bipartite structure
where the in- and out-degrees of nodes did not change but any structural correla-
tion vanished from the network. Repeating our two-way label inference method on
100 of such independently generated random bipartite structures we found that the
precision dropped to 56.2%, with a standard deviation of 5%, which suggests that
our original findings were significant. For precise results see the confusion matrix
in Table 8.
Table 8 Confusion matrix of label inference on the randomised structure.
accuracy=0.562 postpaid prepaid
postpaid 0.539 0.461
prepaid 0.415 0.585
7 Conclusions and Future Work
In this paper we presented novel methods to detect prepaid and postpaid customers
in mobile phone datasets by exploiting both user attributes and observed structural
correlations in the communication network. First we addressed the problem with
known inference methods relying on subscription type labels known for some users.
We showed that in this case SVM provides us the best solution with 0.891 accuracy.
Second, as the main contribution of our work, we addressed a more challenging
problem, to infer subscription labels without prior knowledge of subscription types,
but only relying on user attributes and observed structural correlations. We cast
the classification problem as a problem of graph labelling and solved it by max-
flow min-cut algorithms. With this novel methodology we achieved a classification
accuracy of ∼ 87% which is about ∼ 7% better than supervised learning on user
attributes alone.
16 Authors Suppressed Due to Excessive Length
Third, we provided two methods to infer subscription types of non-company
users. We showed that using node attributes alone we can achieve already ∼ 70%
accuracy of inference. In addition, exploiting present homophilic structural correla-
tions, we obtained good accuracy of inference by using a two-ways label propaga-
tion method.
Our results have certain limitations. As we explained, the incomplete knowl-
edge of subscription types of non-company users makes difficult the full verifica-
tion of any inference problems. We provided one possible indirect solution here but
this should be developed further using more complete datasets. We also generalised
some observations on node features and structural correlations for any node and link
in the communication network, which should be verified. In addition, the two ways
inference method provides more accurate results if the average out-degree of non-
company users is high. For some reasons we found its value relatively small, which
limits the precision of our inference results. We also note that indirect inference
method works in case of competing provides with similar subscription portfolio and
user base, thus where our observations on company users the best generalise.
In the future, there are several avenues to explore. First, one could extend our
approach from binary classification to multi-class classification, which can be sim-
ilarly formulated as a graph labelling problem but with more than two label nodes.
Such problems are known to be NP-hard but greedy algorithms based on max-
flow min-cut have been proposed to achieve approximate solutions [4]. Second,
our dataset is intrinsically dynamical and contains CDRs over one month, what
we all used to predicting user subscription types. It would be interesting to study
the impacts of the dynamics of the mobile call data over time for longer periods to
understand how temporal patterns of communications can improve our predictions.
Possible structural biases in the network between users of different customers could
be also a direction to explore. Our aim here was to contribute to the more general
discussion of user attribute inference and to give possible directions for potential
future applications in behavioural prediction and personal marketing.
Acknowledgment
We acknowledge Grandata to share the data and M. Fixman for his technical sup-
port. This research project was partially granted by the SticAmSud UCOOL project,
INRIA, SoSweet (ANR-15-CE38-0011-01) and CODDDE (ANR-13-CORD-0017-
01).
Prepaid or Postpaid? That is the question 17
Authors’ contribution
All authors read and verified the manuscript. YL, WD, MK, CS and EF participated
in the writing; YL, WD, MK and EF designed the research; and YL run all numerical
calculations.
References
1. Ahmad, M.A., Borbora, Z., Srivastava, J., Contractor, N.: Link prediction across multiple so-
cial networks. In: 2010 IEEE International Conference on Data Mining Workshops (Dec 2010)
2. Bin Bi, Milad Shokouhi, M.K.T.G.: Inferring the demographics of search users. In: 22nd In-
ternational World Wide Web Conference (2013)
3. Boykov, Y., Kolmogorov, V.: An experimental comparison of min-cut/max-flow algorithms
for energy minimization in vision. IEEE Trans. Pattern Anal. Mach. Intell. 26(9), 1124–1137
(Sep 2004)
4. Boykov, Y., Veksler, O., Zabih, R.: Fast approximate energy minimization via graph cuts.
IEEE Trans. Pattern Anal. Mach. Intell. 23(11), 1222–1239 (Nov 2001)
5. Burton, S.H., Giraud-Carrier, C.G.: Discovering social circles in directed graphs. ACM Trans.
Knowl. Discov. Data 8(4) (Aug 2014)
6. Chen, X., Wang, Y., Agichtein, E., Wang, F.: A comparative study of demographic attribute
inference in twitter. In: Proceedings of the Ninth International Conference on Web and Social
Media (2015)
7. Dong, Y., Tang, J., Wu, S., Tian, J., Chawla, N.V., Rao, J., Cao, H.: Link prediction and
recommendation across heterogeneous social networks. In: Proceedings of the 2012 IEEE
12th International Conference on Data Mining (2012)
8. Dong, Y., Yang, Y., Tang, J., Yang, Y., Chawla, N.V.: Inferring user demographics and social
strategies in mobile social networks. In: SIGKDD (2014)
9. Eagle, N., Pentland, A.S., Lazer, D.: Inferring friendship network structure by using mobile
phone data 106(36), 15274–15278 (Sep 2009)
10. Kolmogorov, V., Zabih, R.: What energy functions can be minimized via graph cuts? IEEE
Trans. Pattern Anal. Mach. Intell. 26(2), 65–81 (2004)
11. Kong, X., Zhang, J., Yu, P.S.: Inferring anchor links across multiple heterogeneous social
networks. In: Proceedings of the 22Nd ACM International Conference on Information and
Knowledge Management (2013)
12. Malmi, E., Weber, I.: You are what apps you use: Demographic prediction based on user’s
apps. CoRR (2016)
13. Newman, M.: Networks: An Introduction. Oxford University Press (2010)
14. Papadimitriou, C.H., Steiglitz, K.: Combinatorial Optimization: Algorithms and Complexity.
Prentice-Hall, Inc. (1982)
15. Sun, Y., Aggarwal, C.C., Han, J.: Relation strength-aware clustering of heterogeneous infor-
mation networks with incomplete attributes. Proc. VLDB Endow. 5(5) (Jan 2012)
16. Tang, J., Lou, T., Kleinberg, J.: Inferring social ties across heterogenous networks. In: Pro-
ceedings of the Fifth ACM International Conference on Web Search and Data Mining (2012)
17. Xu, Z., Ke, Y., Wang, Y., Cheng, H., Cheng, J.: A model-based approach to attributed graph
clustering. In: Proceedings of the 2012 ACM SIGMOD International Conference on Manage-
ment of Data (2012)
18. Yang, J., McAuley, J., Leskovec, J.: Community Detection in Networks with Node Attributes.
In: IEEE International Conference On Data Mining (ICDM) (2013)
19. Xu, H., Yang, Y., Wange, L., Liu, W.: Node classification in social network via a factor graph
model. In: Advances in Knowledge Discovery and Data Mining (2013)

